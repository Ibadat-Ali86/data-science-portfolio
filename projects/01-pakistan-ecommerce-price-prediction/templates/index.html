<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-commerce Price Prediction System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Animated Background -->
    <div class="animated-bg">
        <div class="bg-shape shape-1"></div>
        <div class="bg-shape shape-2"></div>
        <div class="bg-shape shape-3"></div>
        <div class="bg-shape shape-4"></div>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-glow"></div>
            <div class="header-content">
                <div class="icon-wrapper">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h1 class="title">
                    <span class="title-word">E-commerce</span>
                    <span class="title-word">Price</span>
                    <span class="title-word">Prediction</span>
                </h1>
                <p class="subtitle">
                    <i class="fas fa-database"></i>
                    Pakistan's Largest E-commerce Dataset
                    <span class="separator">•</span>
                    <i class="fas fa-brain"></i>
                    Machine Learning Model
                </p>
                <div class="stats-badge">
                    <span><i class="fas fa-check-circle"></i> R² = 0.92</span>
                    <span><i class="fas fa-bolt"></i> Real-time</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Prediction Form -->
            <div class="form-container">
                <form id="predictionForm" class="prediction-form">
                    <div class="form-section fade-in">
                        <h2 class="section-title">
                            <i class="fas fa-box"></i>
                            Product Information
                        </h2>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="product_category">
                                    <i class="fas fa-tags"></i>
                                    Product Category *
                                </label>
                                <div class="input-wrapper">
                                    <select id="product_category" name="product_category" required>
                                        <option value="">Select Category</option>
                                        <option value="Women's Fashion">Women's Fashion</option>
                                        <option value="Beauty & Grooming">Beauty & Grooming</option>
                                        <option value="Appliances">Appliances</option>
                                        <option value="Electronics">Electronics</option>
                                        <option value="Entertainment">Entertainment</option>
                                        <option value="Kids & Baby">Kids & Baby</option>
                                        <option value="Men's Fashion">Men's Fashion</option>
                                        <option value="Soghaat">Soghaat</option>
                                        <option value="Others">Others</option>
                                    </select>
                                    <i class="fas fa-chevron-down select-icon"></i>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="quantity_ordered">
                                    <i class="fas fa-shopping-cart"></i>
                                    Quantity Ordered *
                                </label>
                                <div class="input-wrapper">
                                    <input type="number" id="quantity_ordered" name="quantity_ordered" 
                                           min="1" step="1" value="1" required>
                                    <i class="fas fa-hashtag input-icon"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-section fade-in">
                        <h2 class="section-title">
                            <i class="fas fa-receipt"></i>
                            Order Details
                        </h2>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="order_total_amount">
                                    <i class="fas fa-money-bill-wave"></i>
                                    Order Total Amount (PKR) *
                                </label>
                                <div class="input-wrapper">
                                    <input type="number" id="order_total_amount" name="order_total_amount" 
                                           min="0" step="0.01" required placeholder="0.00">
                                    <i class="fas fa-rupee-sign input-icon"></i>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="discount_value">
                                    <i class="fas fa-percent"></i>
                                    Discount Value (PKR)
                                </label>
                                <div class="input-wrapper">
                                    <input type="number" id="discount_value" name="discount_value" 
                                           min="0" step="0.01" value="0" placeholder="0.00">
                                    <span class="discount-badge" id="discountBadge" style="display: none;">0%</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="payment_type">
                                    <i class="fas fa-credit-card"></i>
                                    Payment Type *
                                </label>
                                <div class="input-wrapper">
                                    <select id="payment_type" name="payment_type" required>
                                        <option value="cod">Cash on Delivery (COD)</option>
                                        <option value="easypay">EasyPay</option>
                                        <option value="jazzvoucher">Jazz Voucher</option>
                                        <option value="customercredit">Customer Credit</option>
                                        <option value="Payaxis">Payaxis</option>
                                        <option value="banktransfer">Bank Transfer</option>
                                    </select>
                                    <i class="fas fa-chevron-down select-icon"></i>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="order_status">
                                    <i class="fas fa-clipboard-check"></i>
                                    Order Status *
                                </label>
                                <div class="input-wrapper">
                                    <select id="order_status" name="order_status" required>
                                        <option value="complete">Complete</option>
                                        <option value="received">Received</option>
                                        <option value="canceled">Canceled</option>
                                        <option value="order_refunded">Order Refunded</option>
                                        <option value="pending">Pending</option>
                                    </select>
                                    <i class="fas fa-chevron-down select-icon"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-section fade-in">
                        <h2 class="section-title">
                            <i class="fas fa-calendar-alt"></i>
                            Temporal Information
                        </h2>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="order_datetime">
                                    <i class="fas fa-clock"></i>
                                    Order Date & Time *
                                </label>
                                <div class="input-wrapper">
                                    <input type="datetime-local" id="order_datetime" name="order_datetime" 
                                           required>
                                    <i class="fas fa-calendar input-icon"></i>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="customer_registration_date">
                                    <i class="fas fa-user-plus"></i>
                                    Customer Registration Date
                                </label>
                                <div class="input-wrapper">
                                    <input type="date" id="customer_registration_date" name="customer_registration_date">
                                    <i class="fas fa-calendar input-icon"></i>
                                </div>
                                <small class="form-hint">
                                    <i class="fas fa-info-circle"></i>
                                    Leave empty if new customer
                                </small>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary" id="predictBtn">
                            <span class="btn-content">
                                <span class="btn-text">
                                    <i class="fas fa-magic"></i>
                                    Predict Unit Price
                                </span>
                                <span class="btn-loader" style="display: none;">
                                    <span class="spinner"></span>
                                    Processing...
                                </span>
                            </span>
                            <span class="btn-shine"></span>
                        </button>
                        <button type="reset" class="btn btn-secondary">
                            <i class="fas fa-redo"></i>
                            Reset Form
                        </button>
                    </div>
                </form>
            </div>

            <!-- Results Container -->
            <div id="resultsContainer" class="results-container" style="display: none;">
                <div class="result-card">
                    <div class="result-glow"></div>
                    <div class="result-header">
                        <h2>
                            <i class="fas fa-check-circle"></i>
                            Prediction Result
                        </h2>
                        <button class="close-btn" onclick="closeResults()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="result-content">
                        <div class="price-display">
                            <div class="price-icon">
                                <i class="fas fa-coins"></i>
                            </div>
                            <span class="price-label">Predicted Unit Price</span>
                            <span class="price-value" id="predictedPrice">PKR 0.00</span>
                            <div class="price-currency">PKR</div>
                        </div>
                        <div class="result-details" id="resultDetails"></div>
                    </div>
                </div>
            </div>

            <!-- Error Container -->
            <div id="errorContainer" class="error-container" style="display: none;">
                <div class="error-card">
                    <div class="error-icon-wrapper">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <span class="error-message" id="errorMessage"></span>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <p>
                    <i class="fas fa-robot"></i>
                    Powered by Random Forest Regression Model
                    <span class="separator">•</span>
                    <span class="r2-badge">R² = 0.92</span>
                </p>
                <p class="footer-note">
                    <i class="fas fa-star"></i>
                    Best performance for premium products (PKR 10,000+)
                </p>
            </div>
        </footer>
    </div>

    <script>
        // Set default datetime to now
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('order_datetime').value = now.toISOString().slice(0, 16);
        });

        // Form submission handler
        document.getElementById('predictionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const form = this;
            const predictBtn = document.getElementById('predictBtn');
            const btnText = predictBtn.querySelector('.btn-text');
            const btnLoader = predictBtn.querySelector('.btn-loader');
            const resultsContainer = document.getElementById('resultsContainer');
            const errorContainer = document.getElementById('errorContainer');
            
            // Hide previous results/errors
            resultsContainer.style.display = 'none';
            errorContainer.style.display = 'none';
            
            // Show loading state
            btnText.style.display = 'none';
            btnLoader.style.display = 'inline';
            predictBtn.disabled = true;
            
            try {
                const formData = new FormData(form);
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Animate price counter
                    const priceElement = document.getElementById('predictedPrice');
                    animatePriceCounter(priceElement, data.predicted_price_formatted);
                    
                    // Show feature details with icons
                    const details = document.getElementById('resultDetails');
                    details.innerHTML = `
                        <div class="detail-item fade-in-item">
                            <i class="fas fa-tag"></i>
                            <div>
                                <strong>Category:</strong>
                                <span>${data.features_used.product_category}</span>
                            </div>
                        </div>
                        <div class="detail-item fade-in-item">
                            <i class="fas fa-shopping-bag"></i>
                            <div>
                                <strong>Quantity:</strong>
                                <span>${data.features_used.quantity_ordered}</span>
                            </div>
                        </div>
                        <div class="detail-item fade-in-item">
                            <i class="fas fa-money-bill"></i>
                            <div>
                                <strong>Order Total:</strong>
                                <span>PKR ${parseFloat(data.features_used.order_total_amount).toLocaleString('en-PK', {minimumFractionDigits: 2})}</span>
                            </div>
                        </div>
                        <div class="detail-item fade-in-item">
                            <i class="fas fa-percentage"></i>
                            <div>
                                <strong>Discount Rate:</strong>
                                <span>${(data.features_used.discount_rate * 100).toFixed(1)}%</span>
                            </div>
                        </div>
                        <div class="detail-item fade-in-item">
                            <i class="fas fa-credit-card"></i>
                            <div>
                                <strong>Payment:</strong>
                                <span>${data.features_used.payment_type}</span>
                            </div>
                        </div>
                    `;
                    
                    // Animate detail items
                    setTimeout(() => {
                        const items = details.querySelectorAll('.fade-in-item');
                        items.forEach((item, index) => {
                            setTimeout(() => {
                                item.style.opacity = '1';
                                item.style.transform = 'translateY(0)';
                            }, index * 100);
                        });
                    }, 100);
                    
                    resultsContainer.style.display = 'block';
                    setTimeout(() => {
                        resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }, 100);
                } else {
                    // Display error
                    document.getElementById('errorMessage').textContent = data.error || 'An error occurred';
                    errorContainer.style.display = 'block';
                    errorContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            } catch (error) {
                document.getElementById('errorMessage').textContent = 'Network error: ' + error.message;
                errorContainer.style.display = 'block';
                errorContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            } finally {
                // Reset button state
                btnText.style.display = 'inline';
                btnLoader.style.display = 'none';
                predictBtn.disabled = false;
            }
        });

        function closeResults() {
            document.getElementById('resultsContainer').style.display = 'none';
        }

        // Auto-calculate discount rate with visual feedback
        document.getElementById('discount_value').addEventListener('input', function() {
            const discountValue = parseFloat(this.value) || 0;
            const orderTotal = parseFloat(document.getElementById('order_total_amount').value) || 0;
            const discountBadge = document.getElementById('discountBadge');
            
            if (orderTotal > 0 && discountValue > 0) {
                const discountRate = (discountValue / orderTotal * 100).toFixed(1);
                discountBadge.textContent = discountRate + '%';
                discountBadge.style.display = 'inline-block';
            } else {
                discountBadge.style.display = 'none';
            }
        });

        document.getElementById('order_total_amount').addEventListener('input', function() {
            const discountValue = parseFloat(document.getElementById('discount_value').value) || 0;
            const orderTotal = parseFloat(this.value) || 0;
            const discountBadge = document.getElementById('discountBadge');
            
            if (orderTotal > 0 && discountValue > 0) {
                const discountRate = (discountValue / orderTotal * 100).toFixed(1);
                discountBadge.textContent = discountRate + '%';
                discountBadge.style.display = 'inline-block';
            } else {
                discountBadge.style.display = 'none';
            }
        });

        // Animate price counter
        function animatePriceCounter(element, targetPrice) {
            const price = parseFloat(targetPrice.replace(/[^0-9.]/g, ''));
            const duration = 1500;
            const steps = 60;
            const increment = price / steps;
            let current = 0;
            let step = 0;

            const timer = setInterval(() => {
                step++;
                current += increment;
                if (step >= steps) {
                    element.textContent = targetPrice;
                    clearInterval(timer);
                } else {
                    element.textContent = `PKR ${current.toLocaleString('en-PK', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                }
            }, duration / steps);
        }
    </script>
</body>
</html>

